{"ast":null,"code":"var _jsxFileName = \"E:\\\\Ngon-ngu-kich-ban\\\\ToDo-fontend\\\\src\\\\components\\\\OnlineUsers.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { Users, Wifi, WifiOff } from 'lucide-react';\nimport socketService from '../services/socketService';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst OnlineUsers = ({\n  boardId\n}) => {\n  _s();\n  const [onlineUsers, setOnlineUsers] = useState([]);\n  const [isConnected, setIsConnected] = useState(false);\n  const currentUser = (() => {\n    try {\n      return JSON.parse(localStorage.getItem('user') || '{}');\n    } catch {\n      return {};\n    }\n  })();\n  useEffect(() => {\n    if (!boardId) return;\n\n    // Join board room\n    socketService.joinBoard(boardId);\n\n    // Event listeners\n    const handleUserJoined = user => {\n      if (user.userId === currentUser.id) return; // ignore self\n      setOnlineUsers(prev => {\n        const exists = prev.find(u => u.userId === user.userId);\n        if (!exists) {\n          return [...prev, user];\n        }\n        return prev;\n      });\n    };\n    const handleUserLeft = user => {\n      setOnlineUsers(prev => prev.filter(u => u.userId !== user.userId));\n    };\n    const handleConnect = () => {\n      setIsConnected(true);\n      // Ensure we join the board room after socket establishes\n      socketService.joinBoard(boardId);\n    };\n    const handleDisconnect = () => {\n      setIsConnected(false);\n      setOnlineUsers([]);\n    };\n    const handleOnlineUsers = payload => {\n      if (!payload || payload.boardId !== boardId) return;\n      const others = (payload.users || []).filter(u => u.userId !== currentUser.id);\n      setOnlineUsers(others);\n    };\n\n    // Set up listeners\n    socketService.onUserJoined(handleUserJoined);\n    socketService.onUserLeft(handleUserLeft);\n    socketService.onOnlineUsers(handleOnlineUsers);\n    socketService.onConnect(handleConnect);\n    socketService.onDisconnect(handleDisconnect);\n\n    // Cleanup\n    return () => {\n      socketService.offUserJoined(handleUserJoined);\n      socketService.offUserLeft(handleUserLeft);\n      socketService.offOnlineUsers(handleOnlineUsers);\n      socketService.leaveBoard(boardId);\n    };\n  }, [boardId, currentUser.id]);\n  if (!isConnected) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center space-x-2 text-gray-500\",\n      children: [/*#__PURE__*/_jsxDEV(WifiOff, {\n        size: 16\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"text-sm\",\n        children: \"Offline\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex items-center space-x-2\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex items-center space-x-1\",\n      children: [/*#__PURE__*/_jsxDEV(Wifi, {\n        size: 16,\n        className: \"text-green-500\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Users, {\n        size: 16,\n        className: \"text-gray-600\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n        className: \"text-sm text-gray-600\",\n        children: [onlineUsers.length + 1, \" online\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 7\n    }, this), onlineUsers.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex -space-x-2\",\n      children: [onlineUsers.slice(0, 3).map(user => /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-medium border-2 border-white\",\n        title: user.username,\n        children: user.username.charAt(0).toUpperCase()\n      }, user.userId, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 13\n      }, this)), onlineUsers.length > 3 && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"w-6 h-6 bg-gray-400 rounded-full flex items-center justify-center text-white text-xs font-medium border-2 border-white\",\n        children: [\"+\", onlineUsers.length - 3]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n};\n_s(OnlineUsers, \"Gr1YbB9Eq1wkbq7B5YNLLHg6F/w=\");\n_c = OnlineUsers;\nexport default OnlineUsers;\nvar _c;\n$RefreshReg$(_c, \"OnlineUsers\");","map":{"version":3,"names":["React","useState","useEffect","Users","Wifi","WifiOff","socketService","jsxDEV","_jsxDEV","OnlineUsers","boardId","_s","onlineUsers","setOnlineUsers","isConnected","setIsConnected","currentUser","JSON","parse","localStorage","getItem","joinBoard","handleUserJoined","user","userId","id","prev","exists","find","u","handleUserLeft","filter","handleConnect","handleDisconnect","handleOnlineUsers","payload","others","users","onUserJoined","onUserLeft","onOnlineUsers","onConnect","onDisconnect","offUserJoined","offUserLeft","offOnlineUsers","leaveBoard","className","children","size","fileName","_jsxFileName","lineNumber","columnNumber","length","slice","map","title","username","charAt","toUpperCase","_c","$RefreshReg$"],"sources":["E:/Ngon-ngu-kich-ban/ToDo-fontend/src/components/OnlineUsers.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Users, Wifi, WifiOff } from 'lucide-react';\r\nimport socketService from '../services/socketService';\r\n\r\nconst OnlineUsers = ({ boardId }) => {\r\n  const [onlineUsers, setOnlineUsers] = useState([]);\r\n  const [isConnected, setIsConnected] = useState(false);\r\n  const currentUser = (() => {\r\n    try { return JSON.parse(localStorage.getItem('user') || '{}'); } catch { return {}; }\r\n  })();\r\n\r\n  useEffect(() => {\r\n    if (!boardId) return;\r\n\r\n    // Join board room\r\n    socketService.joinBoard(boardId);\r\n\r\n    // Event listeners\r\n    const handleUserJoined = (user) => {\r\n      if (user.userId === currentUser.id) return; // ignore self\r\n      setOnlineUsers(prev => {\r\n        const exists = prev.find(u => u.userId === user.userId);\r\n        if (!exists) {\r\n          return [...prev, user];\r\n        }\r\n        return prev;\r\n      });\r\n    };\r\n\r\n    const handleUserLeft = (user) => {\r\n      setOnlineUsers(prev => prev.filter(u => u.userId !== user.userId));\r\n    };\r\n\r\n    const handleConnect = () => {\r\n      setIsConnected(true);\r\n      // Ensure we join the board room after socket establishes\r\n      socketService.joinBoard(boardId);\r\n    };\r\n\r\n    const handleDisconnect = () => {\r\n      setIsConnected(false);\r\n      setOnlineUsers([]);\r\n    };\r\n\r\n    const handleOnlineUsers = (payload) => {\r\n      if (!payload || payload.boardId !== boardId) return;\r\n      const others = (payload.users || []).filter(u => u.userId !== currentUser.id);\r\n      setOnlineUsers(others);\r\n    };\r\n\r\n    // Set up listeners\r\n    socketService.onUserJoined(handleUserJoined);\r\n    socketService.onUserLeft(handleUserLeft);\r\n    socketService.onOnlineUsers(handleOnlineUsers);\r\n    socketService.onConnect(handleConnect);\r\n    socketService.onDisconnect(handleDisconnect);\r\n\r\n    // Cleanup\r\n    return () => {\r\n      socketService.offUserJoined(handleUserJoined);\r\n      socketService.offUserLeft(handleUserLeft);\r\n      socketService.offOnlineUsers(handleOnlineUsers);\r\n      socketService.leaveBoard(boardId);\r\n    };\r\n  }, [boardId, currentUser.id]);\r\n\r\n  if (!isConnected) {\r\n    return (\r\n      <div className=\"flex items-center space-x-2 text-gray-500\">\r\n        <WifiOff size={16} />\r\n        <span className=\"text-sm\">Offline</span>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex items-center space-x-2\">\r\n      <div className=\"flex items-center space-x-1\">\r\n        <Wifi size={16} className=\"text-green-500\" />\r\n        <Users size={16} className=\"text-gray-600\" />\r\n        <span className=\"text-sm text-gray-600\">\r\n          {onlineUsers.length + 1} online\r\n        </span>\r\n      </div>\r\n      \r\n      {onlineUsers.length > 0 && (\r\n        <div className=\"flex -space-x-2\">\r\n          {onlineUsers.slice(0, 3).map((user) => (\r\n            <div\r\n              key={user.userId}\r\n              className=\"w-6 h-6 bg-blue-500 rounded-full flex items-center justify-center text-white text-xs font-medium border-2 border-white\"\r\n              title={user.username}\r\n            >\r\n              {user.username.charAt(0).toUpperCase()}\r\n            </div>\r\n          ))}\r\n          {onlineUsers.length > 3 && (\r\n            <div className=\"w-6 h-6 bg-gray-400 rounded-full flex items-center justify-center text-white text-xs font-medium border-2 border-white\">\r\n              +{onlineUsers.length - 3}\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OnlineUsers;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}